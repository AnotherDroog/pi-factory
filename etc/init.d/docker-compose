#!/sbin/openrc-run

# docker-compose init script

depend() {
  need net sshd docker lncm-online
}

start() {
  ebegin "Starting docker-compose"
  if [[ -d /media/important/important/lnd ]]; then
    if [[ -d /media/archive/archive/bitcoin ]]; then
      if [[ -f /media/important/important/lnd/lnd.conf ]]; then
        if [[ -f /media/archive/archive/bitcoin/bitcoin.conf ]]; then
          cd /home/lncm/compose || exit
          docker-compose up -d
        else
          echo "Bitcoin configuration not found"
          exit 1
        fi
      else
        echo "LND configuration not found"
        exit 1
      fi
    else
      echo "Bitcoin directory not found"
      exit 1
    fi
  else
    echo "LND Directory not found"
    exit 1
  fi
  eend $?
}

stop() {
  ebegin "Stopping docker compose"
  # TODO: block until bitcoind has shut down cleanly
  /usr/local/sbin/mana stop
  cd /home/lncm/compose || exit
  docker-compose down

  eend $?
}
